@inject IJSRuntime JS

<section @ref="_scrollHost"
         class="flex-1 overflow-y-auto bg-neutral-100 px-4 py-5 space-y-2">
    @if (!string.IsNullOrWhiteSpace(TimestampText))
    {
        <p class="text-center text-[10px] sm:text-xs text-neutral-500">@TimestampText</p>
    }

    @for (var i = 0; i < Messages.Count; i++)
    {
        var message = Messages[i];
        var previous = i > 0 ? Messages[i - 1] : null;
        var isContinuation = ShouldGroupWithPrevious(message, previous);
        var isOutgoing = message.User.AccountId.Equals(CurrentUser.AccountId);
        var showSender = !isOutgoing
            && !string.IsNullOrWhiteSpace(message.User.Name)
            && !isContinuation;
        var avatarUrl = message.User.AvatarUrl;

        <div class="@(isContinuation ? "space-y-0.5" : "space-y-1")">
            @if (showSender)
            {
                <p class="text-[10px] uppercase tracking-wide text-neutral-500">@message.User.Name</p>
            }

            <MessageBubble Text="@message.Content"
                           IsOutgoing="isOutgoing"
                           AvatarUrl="@avatarUrl"
                           AudioUrl="@message.AudioDataUrl"
                           AudioDuration="@message.AudioDuration" />
        </div>
    }
</section>
