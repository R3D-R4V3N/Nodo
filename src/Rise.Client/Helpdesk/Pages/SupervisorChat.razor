@page "/helpdesk/SupervisorChat"
@using Rise.Client.Chats.Components
@using Rise.Shared.Assets
@layout EmptyLayout

<div class="flex flex-col h-screen max-h-screen overflow-hidden bg-neutral-100 text-neutral-900">

    <ChatHeader
        DisplayName="@GetChatTitle()"
        AvatarUrl="@GetChatImage()"
    />

    <div @ref="_messagesHost" 
         class="flex-1 overflow-y-auto px-3 py-5 bg-neutral-100 space-y-2 no-scrollbar"
         style="@GetMessageHostPaddingStyle()">

        @if (_isLoading)
        {
            <div class="flex justify-center mt-10">
                <span class="loading loading-spinner text-primary"></span>
            </div>
        }
        else if (_chat != null)
        {
            @foreach (var message in _chat.Messages)
            {
                var isMe = UserState.User != null && message.User.AccountId == UserState.User.AccountId;

                <div class="space-y-1">
                    <MessageBubble Text="@message.Content"
                                   IsOutgoing="@isMe"
                                   AvatarUrl="@message.User.AvatarUrl"/>
                </div>
            }
        }
        else
        {
            <p class="text-center text-neutral-500">Het gesprek is niet beschikbaar.</p>
        }
    </div>

    <div @ref="_footerHost" class="fixed bottom-0 left-0 right-0 bg-white z-50">
        <div class="mx-auto px-3 pt-2">
            
            @if (UserState.User?.DefaultChatLines is not null && UserState.User.DefaultChatLines.Any())
            {
                <SuggestionChips Suggestions="UserState.User.DefaultChatLines" OnPick="ApplySuggestion" />
            }
            
            <ChatInput 
                OnSend="HandleUserMessage" 
            />
        </div>
    </div>

</div>

<style>
    html, body { height: 100%; overflow-x: hidden; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>