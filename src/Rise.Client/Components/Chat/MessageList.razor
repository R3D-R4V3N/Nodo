@using Microsoft.AspNetCore.Components
@inject IJSRuntime JS

<section @ref="_scrollHost"
         class="flex-1 overflow-y-auto bg-neutral-100 px-4 py-5 space-y-2">
    @if (ChildContent is not null)
    {
        @ChildContent
    }

    @if (!string.IsNullOrWhiteSpace(TimestampText))
    {
        <p class="text-center text-[10px] sm:text-xs text-neutral-500">@TimestampText</p>
    }

    @foreach (var m in Messages)
    {
        <div class="space-y-1">
            @if (!string.IsNullOrWhiteSpace(m.SenderName))
            {
                <p class="text-[10px] uppercase tracking-wide text-neutral-500 @(m.IsOutgoing ? "text-right" : string.Empty)">@m.SenderName</p>
            }

            <MessageBubble Text="@m.Text"
                           IsOutgoing="@m.IsOutgoing"
                           AvatarUrl="@(m.IsOutgoing ? null : m.AvatarUrl)"
                           AudioUrl="@m.AudioUrl"
                           AudioDuration="@m.AudioDuration" />
        </div>
    }
</section>

@code {
    [Parameter] public IReadOnlyList<Message> Messages { get; set; } = Array.Empty<Message>();
    [Parameter] public string? TimestampText { get; set; } = "Nov 30, 2023, 9:41 AM";
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private ElementReference _scrollHost;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // scrol elke render automatisch naar onder
        await JS.InvokeVoidAsync("scrollToBottom", _scrollHost);
    }
}